<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial â€¢ sGIM</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial">
<meta property="og:description" content="sGIM">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sGIM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/NAME-OF-VIGNETTE.html">Tutorial</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/chencxxy28/sGIM/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tutorial</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/chencxxy28/sGIM/blob/HEAD/vignettes/NAME-OF-VIGNETTE.Rmd" class="external-link"><code>vignettes/NAME-OF-VIGNETTE.Rmd</code></a></small>
      <div class="hidden name"><code>NAME-OF-VIGNETTE.Rmd</code></div>

    </div>

    
    
<p><strong>sGIM</strong> is a semi-parametric constrained
optimization-based approach to integrate summary information from the
external source while accounting for outcome-dependent selection
bias</p>
<p>Recent years have witnessed a rise in the popularity of information
integration without sharing of raw data. By leveraging and incorporating
summary information from external sources, internal studies can realize
enhanced estimation efficiency and prediction accuracy. However, a
noteworthy challenge in utilizing summary-level information is
accommodating the inherent heterogeneity across diverse data sources. In
this study, we delve into the issue of selection bias present in two
cohorts, wherein the bias function depends on the outcome. We introduce
a novel semi-parametric constrained optimization-based approach to
integrate information within this framework, which has not been
extensively explored in existing literature. Our proposed method tackles
selection bias by considering the outcome-dependent bias function and
effectively addresses the estimation uncertainty associated with summary
information from the external source. Our approach facilitates valid
inference even in the absence of a known variance-covariance estimate
from the external source.</p>
<div class="section level2">
<h2 id="installation-the-package">Installation the package<a class="anchor" aria-label="anchor" href="#installation-the-package"></a>
</h2>
<p>To begin with, the user need to install our packages</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://devtools.r-lib.org/" class="external-link">"devtools"</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"chencxxy28/sGIM"</span><span class="op">)</span></span></code></pre></div>
<p>Load necessary packages</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/chencxxy28/sGIM" class="external-link">sGIM</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://mvtnorm.R-forge.R-project.org" class="external-link">mvtnorm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">rootSolve</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Matrix.R-forge.R-project.org" class="external-link">Matrix</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sandwich.R-Forge.R-project.org/" class="external-link">sandwich</a></span><span class="op">)</span></span></code></pre></div>
<p>Generate data with binary outcomes, for illustration. The label shift
parameter is set to be 0.5. We use rejection sampling procedure to
generate the external data with label shift</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#basic setups</span></span>
<span><span class="va">ratio</span><span class="op">&lt;-</span><span class="fl">3</span></span>
<span><span class="va">n</span><span class="op">&lt;-</span><span class="fl">1000</span></span>
<span><span class="va">N</span><span class="op">&lt;-</span><span class="fl">100000</span></span>
<span><span class="va">n_ext</span><span class="op">&lt;-</span><span class="va">n</span><span class="op">*</span><span class="va">ratio</span></span>
<span><span class="va">num.iter</span><span class="op">&lt;-</span><span class="fl">20</span></span>
<span><span class="va">num.cov</span><span class="op">&lt;-</span><span class="fl">4</span></span>
<span><span class="va">betaT</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="va">num.cov</span><span class="op">+</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">gammaT</span><span class="op">&lt;-</span><span class="fl">0.5</span></span>
<span><span class="va">used_index</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">sigma.cov</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">0.3</span>,<span class="va">num.cov</span><span class="op">)</span></span>
<span><span class="va">sigma.cov</span><span class="op">[</span>,<span class="op">]</span><span class="op">&lt;-</span><span class="fl">0.3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">sigma.cov</span><span class="op">)</span><span class="op">&lt;-</span><span class="fl">1</span></span>
<span></span>
<span><span class="co">#generalte external data</span></span>
<span>  <span class="co">##do rejection sampling</span></span>
<span>  <span class="va">num.big</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">N</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">z1_all</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">num.big</span>,<span class="fl">1</span>,<span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="va">z2_all</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">num.big</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">x_raw_all</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html" class="external-link">rmvnorm</a></span><span class="op">(</span><span class="va">num.big</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">num.cov</span><span class="op">)</span>,<span class="va">sigma.cov</span><span class="op">)</span></span>
<span>  <span class="va">x1_all</span><span class="op">&lt;-</span><span class="va">x_raw_all</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="va">z1_all</span></span>
<span>  <span class="va">x2_all</span><span class="op">&lt;-</span><span class="va">x_raw_all</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">+</span><span class="va">z2_all</span></span>
<span>  <span class="va">x3_all</span><span class="op">&lt;-</span><span class="va">x_raw_all</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span></span>
<span>  <span class="va">x4_all</span><span class="op">&lt;-</span><span class="va">x_raw_all</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="va">x_all</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">x1_all</span>,<span class="va">x2_all</span>,<span class="va">x3_all</span>,<span class="va">x4_all</span>,<span class="va">z1_all</span>,<span class="va">z2_all</span><span class="op">)</span></span>
<span>  <span class="va">mu_all</span><span class="op">&lt;-</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x_all</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">betaT</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">y_all</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">num.big</span>,<span class="fl">1</span>,<span class="va">mu_all</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">##check</span></span>
<span>  <span class="va">eva</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">num.big</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">use_index</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">eva</span><span class="op">&lt;</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">gammaT</span><span class="op">*</span><span class="va">y_all</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">0.745861</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">gammaT</span><span class="op">)</span><span class="op">+</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fl">0.745861</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span></span>
<span>                      <span class="op">(</span><span class="fl">1.1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">gammaT</span><span class="op">)</span><span class="op">)</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">use_index</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">##make external data</span></span>
<span>  <span class="va">ext_used</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">use_index</span><span class="op">)</span>,<span class="va">n_ext</span><span class="op">)</span></span>
<span>  <span class="va">y_ext</span><span class="op">&lt;-</span><span class="va">y_all</span><span class="op">[</span><span class="va">use_index</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span><span class="op">[</span><span class="va">ext_used</span><span class="op">]</span></span>
<span>  <span class="va">x_ext</span><span class="op">&lt;-</span><span class="va">x_all</span><span class="op">[</span><span class="va">use_index</span><span class="op">==</span><span class="fl">1</span>,<span class="op">]</span><span class="op">[</span><span class="va">ext_used</span>,<span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x_ext</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span>  <span class="co">#generate internal data</span></span>
<span>  <span class="va">z1_int</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>,<span class="fl">1</span>,<span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="va">z2_int</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">x_raw_int</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html" class="external-link">rmvnorm</a></span><span class="op">(</span><span class="va">n</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">num.cov</span><span class="op">)</span>,<span class="va">sigma.cov</span><span class="op">)</span></span>
<span>  <span class="va">x1_int</span><span class="op">&lt;-</span><span class="va">x_raw_int</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="va">z1_int</span></span>
<span>  <span class="va">x2_int</span><span class="op">&lt;-</span><span class="va">x_raw_int</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">+</span><span class="va">z2_int</span></span>
<span>  <span class="va">x3_int</span><span class="op">&lt;-</span><span class="va">x_raw_int</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span></span>
<span>  <span class="va">x4_int</span><span class="op">&lt;-</span><span class="va">x_raw_int</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="va">x_int</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">x1_int</span>,<span class="va">x2_int</span>,<span class="va">x3_int</span>,<span class="va">x4_int</span>,<span class="va">z1_int</span>,<span class="va">z2_int</span><span class="op">)</span></span>
<span>  <span class="va">mu_int</span><span class="op">&lt;-</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x_int</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">betaT</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">y_int</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>,<span class="fl">1</span>,<span class="va">mu_int</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">y_int</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">y_ext</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>   <span class="co">##calculate theta (summary estimates in the reduced model based on the external data)</span></span>
<span>    <span class="va">fit</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">y_ext</span><span class="op">~</span><span class="va">x_ext</span><span class="op">[</span>,<span class="va">used_index</span><span class="op">]</span><span class="op">-</span><span class="fl">1</span>,family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">theta_ext</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">theta_ext_est</span><span class="op">&lt;-</span><span class="va">theta_ext_ini</span><span class="op">&lt;-</span><span class="va">theta_ext</span></span></code></pre></div>
<p>Calculate the variance-covariance matrix for the parameters in the
reduced model based on the external data</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co">###estimate theta variance</span></span>
<span>  <span class="va">sandwith_self</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">y_ext</span>,<span class="va">x_ext</span>,<span class="va">theta_ext</span>,<span class="va">used_index</span><span class="op">)</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="va">n</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y_ext</span><span class="op">)</span></span>
<span>    <span class="va">ee_all</span><span class="op">&lt;-</span><span class="fl">0</span></span>
<span>    <span class="va">dee_all</span><span class="op">&lt;-</span><span class="fl">0</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span></span>
<span>    <span class="op">{</span></span>
<span>      <span class="va">mu_i</span><span class="op">&lt;-</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x_ext</span><span class="op">[</span><span class="va">i</span>,<span class="va">used_index</span><span class="op">]</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">theta_ext</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>      <span class="va">ee_i</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x_ext</span><span class="op">[</span><span class="va">i</span>,<span class="va">used_index</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">y_ext</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">-</span><span class="va">mu_i</span><span class="op">)</span></span>
<span>      <span class="va">dee_i</span><span class="op">&lt;-</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x_ext</span><span class="op">[</span><span class="va">i</span>,<span class="va">used_index</span><span class="op">]</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">x_ext</span><span class="op">[</span><span class="va">i</span>,<span class="va">used_index</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mu_i</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">mu_i</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">ee_all</span><span class="op">&lt;-</span><span class="va">ee_all</span><span class="op">+</span><span class="va">ee_i</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">ee_i</span><span class="op">)</span><span class="op">/</span><span class="va">n</span></span>
<span>      <span class="va">dee_all</span><span class="op">&lt;-</span><span class="va">dee_all</span><span class="op">+</span><span class="va">dee_i</span><span class="op">/</span><span class="va">n</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/ginv.html" class="external-link">ginv</a></span><span class="op">(</span><span class="va">dee_all</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">ee_all</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/ginv.html" class="external-link">ginv</a></span><span class="op">(</span><span class="va">dee_all</span><span class="op">)</span><span class="op">/</span><span class="va">n</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">v_ext</span><span class="op">&lt;-</span><span class="fu">sandwith_self</span><span class="op">(</span><span class="va">y_ext</span>,<span class="va">x_ext</span>,<span class="va">theta_ext</span>,<span class="va">used_index</span><span class="op">)</span></span></code></pre></div>
<p>Conduct information integration by incorporating summary estimate
(theta_ext_est) and variance matrix (v_ext) into the main model</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">fit</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">y_int</span><span class="op">~</span><span class="va">x_int</span><span class="op">-</span><span class="fl">1</span>,family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">beta_mle</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span></span>
<span>  <span class="va">beta_initial</span><span class="op">&lt;-</span><span class="va">beta_mle</span> <span class="co">#use mle as initial values of beta</span></span>
<span>  </span>
<span>  <span class="va">all_results</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/information.borrowing_lgim_binary.html">information.borrowing_lgim_binary</a></span><span class="op">(</span>beta_initial<span class="op">=</span><span class="va">beta_initial</span>,gamma_initial<span class="op">=</span><span class="fl">0.5</span>,theta_ext_ini<span class="op">=</span><span class="va">theta_ext_ini</span>,theta_ext_est<span class="op">=</span><span class="va">theta_ext_est</span>,v_ext<span class="op">=</span><span class="va">v_ext</span>, y_int<span class="op">=</span><span class="va">y_int</span>,x_int<span class="op">=</span><span class="va">x_int</span>,used_index<span class="op">=</span><span class="va">used_index</span><span class="op">)</span> <span class="co">#here gamma can be valued zero as initial, but it may take more time</span></span>
<span></span>
<span>  <span class="va">beta_est</span><span class="op">&lt;-</span><span class="va">all_results</span><span class="op">$</span><span class="va">beta_est</span> <span class="co">#main parameters in the full model</span></span>
<span>  <span class="va">gamma_est</span><span class="op">&lt;-</span><span class="va">all_results</span><span class="op">$</span><span class="va">gamma_est</span> <span class="co">#shift parameter</span></span>
<span>  <span class="va">theta_est</span><span class="op">&lt;-</span><span class="va">all_results</span><span class="op">$</span><span class="va">theta_est</span> <span class="co">#estimated parameters in the reduced model</span></span></code></pre></div>
<p>Calculate the asymptotic standard errors</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">V_asymptotic</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/asymptotic_var_general_binary.html">asymptotic_var_general_binary</a></span><span class="op">(</span>beta_est<span class="op">=</span><span class="va">beta_est</span>,gamma_est<span class="op">=</span><span class="va">gamma_est</span>,theta_est<span class="op">=</span><span class="va">theta_est</span>,v_ext<span class="op">=</span><span class="va">v_ext</span>,y_int<span class="op">=</span><span class="va">y_int</span>,x_int<span class="op">=</span><span class="va">x_int</span>,used_index<span class="op">=</span><span class="va">used_index</span><span class="op">)</span></span>
<span>  <span class="va">V_asymptotic</span><span class="op">&lt;-</span><span class="va">V_asymptotic</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">v_ext</span><span class="op">)</span><span class="op">)</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">v_ext</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="co">#the first nrow(v_ext) elements are related to lagrange multiplier</span></span>
<span>  <span class="va">beta_v_iter</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">V_asymptotic</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x_int</span><span class="op">)</span>,<span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x_int</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="co">#asymptotic standard error for main parameters in the full model</span></span>
<span>  <span class="va">gamma_v_iter</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="va">V_asymptotic</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x_int</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x_int</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="co">#asymptotic standard error for the shift parameter</span></span>
<span>  <span class="va">theta_v_iter</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">V_asymptotic</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x_int</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x_int</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="co">#asymptotic standard error for estimated parameters in the reduced model</span></span></code></pre></div>
<p>To compare, we also provide the function for GIM estimate, which
could lead to biased estimates in the presence of label shift.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_results_gim</span><span class="op">&lt;-</span><span class="fu">information.borrowing_gim</span><span class="op">(</span>beta_initial<span class="op">=</span><span class="va">beta_initial</span>,theta_ext_ini<span class="op">=</span><span class="va">theta_ext_ini</span>,theta_ext_est<span class="op">=</span><span class="va">theta_ext_est</span>,v_ext<span class="op">=</span><span class="va">v_ext</span>,y_int<span class="op">=</span><span class="va">y_int</span>,x_int<span class="op">=</span><span class="va">x_int</span>,used_index<span class="op">=</span><span class="va">used_index</span><span class="op">)</span></span>
<span></span>
<span><span class="va">beta_est_gim</span><span class="op">&lt;-</span><span class="va">all_results_gim</span><span class="op">$</span><span class="va">beta_est</span></span></code></pre></div>
<p>When the variance-covariance matrix is not available, we should apply
the proposed iterative updating scheme to recover the matrix v_ext and
do information integration. More demos including the case of continuous
outcome will be uploaded shortly.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Chixiang Chen.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
